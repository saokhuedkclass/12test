<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Tr·∫Øc Nghi·ªám Online</title>
    <style>
        :root { --primary: #4CAF50; --bg: #f4f4f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); }
        .part-title { background: #e8f5e9; padding: 10px; border-left: 5px solid var(--primary); margin-top: 30px; font-weight: bold; }
        .question { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed #ddd; }
        .q-text { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .options label { display: block; padding: 5px; cursor: pointer; }
        .options label:hover { background: #f0f0f0; }
        .tf-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
        .tf-opts { display: flex; gap: 15px; min-width: 100px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; margin-top: 20px; }
        button:hover { background: #45a049; }
        img { max-width: 100%; display: block; margin: 10px 0; }
        #timer { position: fixed; top: 10px; right: 10px; background: #ff5722; color: white; padding: 10px 20px; border-radius: 30px; font-weight: bold; }
        #notification { margin-top: 20px; padding: 15px; text-align: center; font-weight: bold; display: none; border-radius: 5px; }
        .success { background: #dff0d8; color: #3c763d; border: 1px solid #d6e9c6; }
        .info-box { background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .info-box input { width: 100%; margin-bottom: 10px; }
    </style>
    <script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } }; </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>

<div id="timer">‚è±Ô∏è <span id="countdown">30:00</span></div>

<div class="container">
    <h1>üìù ƒê·ªÄ THI T·ª∞ ƒê·ªòNG H√ìA</h1>
    
    <div class="info-box">
        <input type="text" id="fullname" placeholder="H·ªç v√† t√™n h·ªçc sinh..." required>
        <input type="text" id="class_name" placeholder="L·ªõp..." required>
    </div>

    <div id="quiz-container"></div>

    <button id="submit-btn" onclick="submitTest()">N·ªòP B√ÄI</button>
    <div id="notification"></div>
</div>

<script>
    // Link Google Script c·ªßa b·∫°n
    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbyg5KT1vKt8j-TkjJEQEOxmfj2IOgLbESw8VMyfWoVygXtYsolpiJbf9-imXl8_AB_-_g/exec';
    
    // Th·ªùi gian l√†m b√†i (ph√∫t)
    const TIME_LIMIT = 30;

    // --- DANH S√ÅCH C√ÇU H·ªéI ---
    // type 1: Tr·∫Øc nghi·ªám (4 ch·ªçn 1)
    // type 2: ƒê√∫ng Sai
    // type 3: Tr·∫£ l·ªùi ng·∫Øn
    // img: "link_anh.png" (n·∫øu c√≥, kh√¥ng c√≥ th√¨ b·ªè tr·ªëng)
    
    const questions = [
        // --- PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM ---
        {
            type: 1,
            text: "C√¢u 1: Nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh $log_2(x+1)=3$ l√†:",
            options: ["x=7", "x=9", "x=5", "x=8"], // Th·ª© t·ª± A, B, C, D
            correct: "A" // ƒê√°p √°n ƒë√∫ng l√† A
        },
        {
            type: 1,
            text: "C√¢u 2: Cho h√†m s·ªë c√≥ ƒë·ªì th·ªã nh∆∞ h√¨nh v·∫Ω:",
            img: "images/cau2.PNG", // C√≥ ·∫£nh th√¨ ƒëi·ªÅn v√†o ƒë√¢y
            options: ["2", "1", "3", "0"],
            correct: "B"
        },
        {
            type: 1,
            text: "C√¢u 3: Cho h√†m s·ªë c√≥ ƒë·ªì th·ªã nh∆∞ h√¨nh v·∫Ω:",
            img: "images/cau2.PNG", // C√≥ ·∫£nh th√¨ ƒëi·ªÅn v√†o ƒë√¢y
            options: ["2", "1", "3", "0"],
            correct: "B"
        },
        // Mu·ªën th√™m c√¢u h·ªèi? Copy kh·ªëi tr√™n v√† d√°n xu·ªëng d∆∞·ªõi

        // --- PH·∫¶N 2: ƒê√öNG SAI ---
        {
            type: 2,
            text: "C√¢u 4: ƒê·ªçc ƒëo·∫°n vƒÉn sau v√† ch·ªçn ƒê√∫ng/Sai...",
            sub_questions: [
                "a) √ù th·ª© nh·∫•t c·ªßa c√¢u h·ªèi.",
                "b) √ù th·ª© hai c·ªßa c√¢u h·ªèi.",
                "c) √ù th·ª© ba.",
                "d) √ù th·ª© t∆∞."
            ],
            correct: ["true", "false", "true", "true"] // ƒê√°p √°n cho a, b, c, d
        },
        {
            type: 2,
            text: "C√¢u 5: ƒê·ªçc ƒëo·∫°n vƒÉn sau v√† ch·ªçn ƒê√∫ng/Sai...",
            sub_questions: [
                "a) √ù th·ª© nh·∫•t c·ªßa c√¢u h·ªèi.",
                "b) √ù th·ª© hai c·ªßa c√¢u h·ªèi.",
                "c) √ù th·ª© ba.",
                "d) √ù th·ª© t∆∞."
            ],
            correct: ["true", "false", "true", "true"] // ƒê√°p √°n cho a, b, c, d
        },

        // --- PH·∫¶N 3: TR·∫¢ L·ªúI NG·∫ÆN ---
        {
            type: 3,
            text: "C√¢u 4: Write the past participle of 'go'.",
            correct: "gone" // ƒê√°p √°n (m√°y s·∫Ω t·ª± vi·∫øt th∆∞·ªùng, x√≥a d·∫•u c√°ch th·ª´a)
        },
        {
            type: 3,
            text: "C√¢u 5: T√≠nh $15 + 20$ b·∫±ng bao nhi√™u?",
            correct: "35"
        }
    ];

</script>

<script>
    let timerInterval;
    let timeInSeconds = TIME_LIMIT * 60;

    // T·ª± ƒë·ªông v·∫Ω c√¢u h·ªèi ra m√†n h√¨nh
    window.onload = function() {
        renderQuiz();
        startTimer();
    };

    function renderQuiz() {
        const container = document.getElementById("quiz-container");
        let html = "";
        let p1_title = false, p2_title = false, p3_title = false;

        questions.forEach((q, index) => {
            let qIndex = index + 1; // T·ª± ƒë·ªông ƒë√°nh s·ªë c√¢u 1, 2, 3...
            
            // T·ª± ƒë·ªông th√™m ti√™u ƒë·ªÅ ph·∫ßn
            if(q.type === 1 && !p1_title) { html += `<div class="part-title">PH·∫¶N I: TR·∫ÆC NGHI·ªÜM (0.25ƒë/c√¢u)</div>`; p1_title = true; }
            if(q.type === 2 && !p2_title) { html += `<div class="part-title">PH·∫¶N II: ƒê√öNG SAI (Thang ƒëi·ªÉm b·∫≠c thang)</div>`; p2_title = true; }
            if(q.type === 3 && !p3_title) { html += `<div class="part-title">PH·∫¶N III: TR·∫¢ L·ªúI NG·∫ÆN (0.5ƒë/c√¢u)</div>`; p3_title = true; }

            html += `<div class="question">`;
            html += `<div class="q-text">${q.text}</div>`;
            if(q.img) html += `<img src="${q.img}" width="300">`;

            // X·ª≠ l√Ω Giao di·ªán t·ª´ng lo·∫°i c√¢u
            if (q.type === 1) { // Tr·∫Øc nghi·ªám
                html += `<div class="options">`;
                const labels = ["A", "B", "C", "D"];
                q.options.forEach((opt, i) => {
                    html += `<label><input type="radio" name="q_${index}" value="${labels[i]}"> <b>${labels[i]}.</b> ${opt}</label>`;
                });
                html += `</div>`;
            } 
            else if (q.type === 2) { // ƒê√∫ng sai
                html += `<div class="tf-container">`;
                q.sub_questions.forEach((sub, j) => {
                    html += `<div class="tf-row">
                                <div style="flex:1">${sub}</div>
                                <div class="tf-opts">
                                    <label><input type="radio" name="tf_${index}_${j}" value="true"> ƒê</label>
                                    <label><input type="radio" name="tf_${index}_${j}" value="false"> S</label>
                                </div>
                             </div>`;
                });
                html += `</div>`;
            } 
            else if (q.type === 3) { // Tr·∫£ l·ªùi ng·∫Øn
                html += `<input type="text" name="sa_${index}" placeholder="Nh·∫≠p ƒë√°p √°n...">`;
            }
            html += `</div>`;
        });

        container.innerHTML = html;
        // K√≠ch ho·∫°t l·∫°i MathJax cho c√¢u h·ªèi m·ªõi sinh ra
        if(window.MathJax) MathJax.typeset(); 
    }

    function startTimer() {
        const display = document.getElementById('countdown');
        const timerBox = document.getElementById('timer');
        timerInterval = setInterval(() => {
            let m = Math.floor(timeInSeconds / 60);
            let s = timeInSeconds % 60;
            display.textContent = (m<10?"0"+m:m) + ":" + (s<10?"0"+s:s);
            if (timeInSeconds < 60) timerBox.style.background = "#d32f2f";
            if (--timeInSeconds < 0) {
                clearInterval(timerInterval);
                submitTest(true);
            }
        }, 1000);
    }

    function submitTest(auto = false) {
        const fullName = document.getElementById("fullname").value.trim();
        const className = document.getElementById("class_name").value.trim();
        if (!auto && (!fullName || !className)) { alert("Vui l√≤ng ƒëi·ªÅn t√™n v√† l·ªõp!"); return; }

        let scoreP1 = 0, scoreP2 = 0, scoreP3 = 0;

        questions.forEach((q, index) => {
            // Ch·∫•m ƒëi·ªÉm Ph·∫ßn 1
            if (q.type === 1) {
                let userOpt = document.querySelector(`input[name="q_${index}"]:checked`);
                if (userOpt && userOpt.value === q.correct) scoreP1 += 0.25;
            }
            // Ch·∫•m ƒëi·ªÉm Ph·∫ßn 2
            else if (q.type === 2) {
                let countCorrect = 0;
                q.correct.forEach((ans, j) => {
                    let userOpt = document.querySelector(`input[name="tf_${index}_${j}"]:checked`);
